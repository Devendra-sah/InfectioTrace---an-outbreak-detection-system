<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>InfectioTrace - AI-Powered Outbreak Detection</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='simulation_style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='csv_style.css') }}" />
</head>

<body>
  <!-- Header Section -->
  <div class="header">
    <h1>InfectioTrace</h1>
    <div class="subtitle">AI-Powered Outbreak Detection System</div>
    <div class="subtitle">Logic-Based Early Warning for Public Health</div>
  </div>

  <!-- Mode Selector Tabs -->
  <div class="mode-selector">
    <div class="mode-tab active" id="simulationTab" onclick="switchMode('simulation')">
      üéÆ SIMULATION MODE
    </div>
    <div class="mode-tab" id="csvTab" onclick="switchMode('csv')">
      üìä CSV ANALYSIS MODE
    </div>
  </div>

  <!-- Simulation Mode Content -->
  <div id="simulation-mode" class="mode-content active">
    <div class="simulation-container">
      <!-- Clinic Network Visualization -->
      <div class="network-section">
        <h2>Clinic Network Visualization</h2>
        <p class="section-subtitle">
          Real-time monitoring of healthcare facilities across the region
        </p>

        <div class="clinic-grid-container">
          <div class="grid-labels-y">
            <div>A</div>
            <div>B</div>
            <div>C</div>
            <div>D</div>
            <div>E</div>
            <div>F</div>
            <div>G</div>
            <div>H</div>
            <div>I</div>
            <div>J</div>
          </div>
          <div class="grid-wrapper">
            <div class="clinic-grid" id="clinicGrid">
              <!-- Grid will be generated by JS -->
            </div>
            <div class="grid-labels-x">
              <div>0</div>
              <div>1</div>
              <div>2</div>
              <div>3</div>
              <div>4</div>
              <div>5</div>
              <div>6</div>
              <div>7</div>
              <div>8</div>
              <div>9</div>
            </div>
          </div>
        </div>

        <!-- Legend -->
        <div class="legend">
          <div class="legend-item">
            <span class="legend-color" style="background: #10b981"></span>
            <span>Normal</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background: #f59e0b"></span>
            <span>Warning</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background: #ef4444"></span>
            <span>Alert</span>
          </div>
        </div>
      </div>

      <!-- Control Panel (IDs/classes aligned to first file) -->
      <div class="controls-section">
        <h2>‚öôÔ∏è Simulation Controls</h2>

        <div class="controls-grid">
          <!-- Play/Pause/Reset Buttons -->
          <div class="control-group">
            <h3>Playback</h3>
            <div class="control-buttons">
              <button class="btn btn-primary" id="startBtn">
                ‚ñ∂Ô∏è Start Simulation
              </button>
              <button class="btn btn-secondary" id="pauseBtn" disabled>
                ‚è∏Ô∏è Pause
              </button>
              <button class="btn btn-danger" id="resetBtn">
                üîÑ Reset
              </button>
            </div>
          </div>

          <!-- Speed Control -->
          <div class="control-group">
            <h3>Simulation Speed</h3>
            <div class="slider-container">
              <input type="range" id="speedSlider" min="1" max="10" value="1" class="slider" />
              <span class="slider-value" id="speedValue">1x</span>
            </div>
          </div>

          <!-- Number of Clinics -->
          <div class="control-group">
            <h3>Number of Clinics</h3>
            <div class="slider-container">
              <input type="range" id="clinicSlider" min="6" max="20" value="12" class="slider" />
              <span class="slider-value" id="clinicValue">12</span>
            </div>
          </div>

          <!-- Outbreak Probability -->
          <div class="control-group">
            <h3>Outbreak Probability</h3>
            <div class="slider-container">
              <input type="range" id="probSlider" min="10" max="100" value="30" class="slider" />
              <span class="slider-value" id="probValue">30%</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Metrics Dashboard -->
      <div class="metrics-section">
        <h3>üìä Real-Time Metrics</h3>
        <div class="metrics-dashboard">
          <div class="metric-card">
            <div class="metric-icon">üìÖ</div>
            <div class="metric-label">Simulation Day</div>
            <div class="metric-value" id="simDay">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">üè•</div>
            <div class="metric-label">Total Cases</div>
            <div class="metric-value" id="totalCases">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">üìà</div>
            <div class="metric-label">Daily Cases</div>
            <div class="metric-value" id="dailyCases">0</div>
          </div>
          <div class="metric-card">
            <div class="metric-icon">‚ö†Ô∏è</div>
            <div class="metric-label">Active Alerts</div>
            <div class="metric-value" id="activeAlerts">0</div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <div class="chart-container">
          <h3>üìä Daily Cases Trend</h3>
          <canvas id="dailyCasesChart"></canvas>
        </div>
        <div class="chart-container">
          <h3>üö® Cumulative Alerts</h3>
          <canvas id="alertsChart"></canvas>
        </div>
      </div>

      <!-- Live Alert Feed -->
      <div class="alerts-feed">
        <h2>üö® Live Alert Feed</h2>
        <div class="feed-container" id="alertsFeed">
          <div class="no-alerts">
            No alerts yet. Start simulation to begin monitoring.
          </div>
        </div>
      </div>

      <!-- Alert Detection Rules -->
      <section class="detection-section">
        <h2 class="section-heading">Detection Rules & Logic</h2>
        <button class="btn-toggle" id="rulesToggle" onclick="toggleRules()">
          Show Details
        </button>

        <div class="rules-container" id="rulesContainer" style="display: none">
          <!-- Rule 1 -->
          <div class="rule-card">
            <div class="rule-header">
              <div class="rule-icon">üå°Ô∏è</div>
              <div class="rule-title-section">
                <h3 class="rule-title">Rule 1: High Fever+Cough Cases</h3>
                <p class="rule-desc">
                  Triggers when fever+cough cases exceed 50 in 7-day window
                </p>
              </div>
              <div class="rule-status-badge inactive" id="rule1Status">
                INACTIVE
              </div>
            </div>

            <div class="rule-details">
              <div class="detail-item">
                <span class="detail-label">Threshold:</span>
                <span class="detail-value">50 cases</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Window:</span>
                <span class="detail-value">7 days</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Severity:</span>
                <span class="detail-value severity-high">HIGH</span>
              </div>
            </div>
          </div>

          <!-- Rule 2 -->
          <div class="rule-card">
            <div class="rule-header">
              <div class="rule-icon">üìç</div>
              <div class="rule-title-section">
                <h3 class="rule-title">Rule 2: Geographic Clustering</h3>
                <p class="rule-desc">
                  Detects when single clinic reports >10 fever+cough cases
                </p>
              </div>
              <div class="rule-status-badge inactive" id="rule2Status">
                INACTIVE
              </div>
            </div>

            <div class="rule-details">
              <div class="detail-item">
                <span class="detail-label">Threshold:</span>
                <span class="detail-value">10 cases</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Scope:</span>
                <span class="detail-value">Single clinic</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Severity:</span>
                <span class="detail-value severity-medium">MEDIUM</span>
              </div>
            </div>
          </div>

          <!-- Rule 3 -->
          <div class="rule-card">
            <div class="rule-header">
              <div class="rule-icon">üìà</div>
              <div class="rule-title-section">
                <h3 class="rule-title">Rule 3: Rapid Increase Detection</h3>
                <p class="rule-desc">
                  Triggers when daily cases double compared to 7-day average
                </p>
              </div>
              <div class="rule-status-badge inactive" id="rule3Status">
                INACTIVE
              </div>
            </div>

            <div class="rule-details">
              <div class="detail-item">
                <span class="detail-label">Multiplier:</span>
                <span class="detail-value">2.0x</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Baseline:</span>
                <span class="detail-value">7-day average</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Severity:</span>
                <span class="detail-value severity-high">HIGH</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- SYSTEM PERFORMANCE SECTION -->
      <section class="performance-section">
        <h2 class="section-heading">‚ö° System Performance</h2>

        <div class="performance-grid">
          <!-- Detection Accuracy -->
          <div class="performance-card">
            <h4 class="perf-label">Detection Accuracy</h4>
            <div class="perf-value-large">
              <span id="perfAccuracy">--</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar" id="perfAccuracyBar" style="width: 0%"></div>
            </div>
          </div>

          <!-- Average Detection Time -->
          <div class="performance-card">
            <h4 class="perf-label">Average Detection Time</h4>
            <div class="perf-value-large">
              <span id="perfDetectionTime">--</span>
              <span class="perf-unit">days</span>
            </div>
            <p class="perf-target">Target: ‚â§3 days</p>
          </div>

          <!-- False Positive Rate -->
          <div class="performance-card">
            <h4 class="perf-label">False Positive Rate</h4>
            <div class="perf-value-large">
              <span id="perfFalsePositive">0</span><span class="perf-unit">%</span>
            </div>
            <p class="perf-target">Target: ‚â§5%</p>
          </div>

          <!-- System Uptime -->
          <div class="performance-card">
            <h4 class="perf-label">System Uptime</h4>
            <div class="perf-value-large">
              <span id="perfUptime">100</span><span class="perf-unit">%</span>
            </div>
            <div class="online-badge">ONLINE</div>
          </div>
        </div>
      </section>

      <!-- Status Message -->
      <div class="status-message" id="statusMessage">
        üéÆ Ready to start. Click START SIMULATION to begin monitoring.
      </div>
    </div>
  </div>

  <!-- CSV Analysis Mode Content -->
  <div id="csv-mode" class="mode-content">
    <div class="csv-container">
      <!-- Upload Section -->
      <div class="upload-section">
        <div class="upload-zone" id="uploadZone">
          <h2>üìÅ Upload Clinic Data CSV</h2>
          <p>Drag and drop your CSV file here, or click to browse</p>
          <input type="file" id="csvFile" accept=".csv" style="display: none" />
          <button class="btn btn-primary" onclick="document.getElementById('csvFile').click()">
            Choose File
          </button>
          <button class="btn btn-secondary" onclick="downloadTemplate()">
            üì• Download CSV Template
          </button>
        </div>

        <div class="format-info">
          <h4>üìã Required CSV Format:</h4>
          <ul>
            <li>date (YYYY-MM-DD format)</li>
            <li>clinic_name</li>
            <li>total_patients</li>
            <li>fever_cases, cough_cases, fever_and_cough_cases</li>
            <li>sore_throat_cases, body_ache_cases, headache_cases</li>
            <li>severe_cases</li>
          </ul>
        </div>
      </div>

      <!-- Analysis Results -->
      <div id="csvResults" , class="results-section" style="display: none">
        <!-- Risk Assessment -->
        <div class="risk-assessment">
          <h2>üìä Outbreak Risk Assessment</h2>
          <div class="risk-score-display" id="riskScoreDisplay">
            <div class="risk-score" id="riskScore">--</div>
            <div class="risk-level" id="riskLevel">Loading...</div>
          </div>
          <div class="risk-details" id="riskDetails"></div>
        </div>

        <!-- Alerts -->
        <div class="csv-alerts-section">
          <h2>üö® Detected Alerts</h2>
          <div id="csvAlertsList"></div>
        </div>

        <!-- Data Summary -->
        <div class="data-summary">
          <h2>üìà Data Summary</h2>
          <div id="dataSummary"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js Library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="{{ url_for('static', filename='app.js') }}"></script>
  <script src="{{ url_for('static', filename='simulation_app.js') }}"></script>
  <script src="{{ url_for('static', filename='csv_app.js') }}"></script>
</body>

</html>